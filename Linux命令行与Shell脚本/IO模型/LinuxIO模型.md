## Linux IO模型

> ### **Linux 性能指标命令**
>
> - #### top
>
>   >top参数  top [command-options]
>   >
>   >| 选项 |                             功能                             |
>   >| :--: | :----------------------------------------------------------: |
>   >|  -d  | 指定每两次屏幕信息刷新之间的时间间隔，如希望每秒刷新一次，则使用：top -d 1 |
>   >|  -p  |             通过指定PID来仅仅监控某个进程的状态              |
>   >|  -S  |                         指定累计模式                         |
>   >|  -s  | 使top命令在安全模式中运行。这将去除交互命令所带来的潜在危险  |
>   >|  -i  |              使top不显示任何闲置或者僵死的进程               |
>   >|  -c  |               显示整个命令行而不只是显示命令名               |
>   >
>   >top交互功能
>   >
>   >| 按键 | 功能                  |
>   >| ---- | --------------------- |
>   >| 1    | 监控每个逻辑CPU的状况 |
>   >| u    | 查看相应的用户进程    |
>   >| E    | 切换内存单位          |
>   >
>   ><img src="img\image-20221206143659815.png" alt="image-20221206143659815" style="zoom: 80%;" /> 
>   >
>   >第一行：系统时间，运行时间，用户登录数量，load average
>   >
>   >> *load average数据是每隔5秒钟检查一次活跃的进程数，然后按特定算法计算出的数值。如果这个数除以逻辑CPU的数量，结果高于5的时候就表明系统在超负荷运转了。*
>   >
>   >第二行：系统进程数，total(总数)，zombile (僵尸进程)
>   >
>   >> *zombile，进程指令已执行完成，但PCB(进程控制块)未被系统回收，例如子进程比父进程先退出，父进程没释放子进程PCB，子进程为僵尸进程，无法推进任务执行，占用PID且浪费内存系统资源*
>   >
>   >第三行：Cpu状态：us，sy目态与管态占用CPU百分比，id：空闲C百分比，wa：IO等待占用比，hi：硬中断占用比，si：软中断占用比
>   >
>   >
>   >
>   >第四行：Mem内存状态：total：物理内存，used：使用内存，free：空闲内存，buffers：缓存内存量
>   >
>   >> *used与free表示系统内核控制的内存数与暂存的内存量，实际剩余内存量需要使用 free+buffers+cached近似*
>   >
>   >第五行：Swap交换分区（虚拟内存）
>   >
>   >> *扩充物理内存大小，内存不够时页面置换算法将内存数据转存到磁盘上，频繁的swap将导致内存跳东，影响系统性能*
>   >
>   >PID进程表
>   >
>   >> - PR（ 进程优先级）NI(负值表示高优先级)，S（D=不可中断的睡眠状态 R=运行 S=睡眠 T=跟踪/停止 Z=僵尸进程）
>
> - #### vmstat (内核线程、虚拟内存、磁盘、陷阱和 CPU 活动的统计信息)
>
>   > vmstat [options] [delay [count]]
>   >
>   > | 选项   | 功能                                                  |
>   > | ------ | ----------------------------------------------------- |
>   > | -a     | 显示活跃和非活跃内存                                  |
>   > | -f     | 显示从系统启动至今的fork数量（复制进程）              |
>   > | -m     | 显示内核参数                                          |
>   > | -s     | 获取内存，CPU，交换区，中断次数，上下文切换次数等信息 |
>   > | -d/ -D | 显示磁盘相关统计信息及多种系统活动数量                |
>   > | -S     | 输出单位（k，K，m，M）                                |
>   > | delay  | 刷新时间间隔（秒）                                    |
>   > | count  | 刷新次数                                              |
>   >
>   > ![image-20221206163841485](img\image-20221206163841485.png) 
>   >
>   > r：处于Runnable状态进程数量
>   >
>   > b：不可中断睡眠状态进程数量
>   >
>   > swpd：已有虚拟内存
>   >
>   > free：空闲内存
>   >
>   > buff：缓存区内存
>   > cache：缓存内存
>   >
>   > inact：不活跃的内存量（-a)
>   >
>   > actice：活跃内存量(-a)
>   >
>   > si: swap区写入内存大小（每秒）
>   >
>   > so：内存写入swap大小（每秒）
>   >
>   > bi：每秒读取磁盘块数
>   >
>   > bo：每秒写入磁盘块数
>   >
>   > in：每秒中断次数
>   >
>   > cs：上下文切换次数
>
> - #### sar (全面地获取系统的 CPU、运行队列、磁盘读写（I/O）、分区（交换区）、内存、CPU 中断和网络等性能数据)
>
>   > sar [options] [-o filename] interval [count]
>   >
>   > - -o 将结果重定向到指定文件中
>   > - interval：表示采样间隔时间
>   > - count：采样次数
>   >
>   > |   选项  |                             功能                             |
>   > | ---- | :----------------------------------------------------------: |
>   > | -A   |     显示系统所有资源设备（CPU、内存、磁盘）的运行状况。      |
>   > | -u   |          显示系统所有 CPU 在采样时间内的负载状态。           |
>   > | -P   |             显示当前系统中指定 CPU 的使用情况。              |
>   > | -d   |         显示系统所有硬盘设备在采样时间内的使用状态。         |
>   > | -r   |             显示系统内存在采样时间内的使用情况。             |
>   > | -b   |              显示缓冲区在采样时间内的使用情况。              |
>   > | -v   |        显示 inode 节点、文件和其他内核表的统计信息。         |
>   > | -n   | 显示网络运行状态，此选项后可跟 DEV（显示网络接口信息）、EDEV（显示网络错误的统计数据）、SOCK（显示套接字信息）和 FULL（等同于使用 DEV、EDEV和SOCK）等，有关更多的选项，可通过执行 man sar 命令查看。 |
>   > | -q   |      显示运行列表中的进程数、进程大小、系统平均负载等。      |
>   > | -R   |                 显示进程在采样时的活动情况。                 |
>   > | -y   |              显示终端设备在采样时间的活动情况。              |
>   > | -w   |             显示系统交换活动在采样时间内的状态。             |
>
> - #### strace (诊断、调试、统计与一体的工具，可用来追踪调试程序，能够与其他命令搭配使用)
>
>   > 
>
> - #### ipcs(多进程间通信常用的技术手段包括共享内存、消息队列、信号量)
>
> - #### iostat(输出磁盘IO 和 CPU的统计信息)
>
>   > iostat [ options ] [ <interval> [ <count> ] ]
>   >
>   > | 选项  | 功能                                                         |
>   > | ----- | ------------------------------------------------------------ |
>   > | -c    | 显示CPU使用情况                                              |
>   > | -d    | 显示磁盘使用情况                                             |
>   > | -N    | 显示[磁盘阵列](https://so.csdn.net/so/search?q=磁盘阵列&spm=1001.2101.3001.7020)(LVM) 信息 |
>   > | -n    | 显示NFS 使用情况（网络文件系统）                             |
>   > | -k -m | 单位                                                         |
>   > | -t    | 报告每秒向终端读取和写入的字符数和CPU的信息                  |
>   > | -x    | 显示详细信息                                                 |
>   > | -p    | [磁盘] 显示磁盘和分区的情况                                  |
>
> - #### lsof(列出系统中已经打开的文件，包括普通文件，目录，块特殊文件，字符特殊文件，正在执行的文本引用，库，流或网络文件)
>
>   > iostat [ options ]
>   >
>   > | 选项        | 功能                                                         |
>   > | ----------- | ------------------------------------------------------------ |
>   > | -p pid      | 输出指定进程打开的文件                                       |
>   > | filename    | 显示开启文件的进程                                           |
>   > | -I          | 输出中使用ID代替用户名                                       |
>   > | -u username | 输出指定用户打开的文件                                       |
>   > | -c <进程名> | 匹配command 列中包换字符                                     |
>   > | -d <文件号> | 出占用该文件号的进程                                         |
>   > | +d <目录>   | 列出目录下被打开的文件                                       |
>   > | +D <目录>   | 递归列出目录下被打开的文件                                   |
>   > | -n <目录>   | 列出使用NFS的文件                                            |
>   > | -i <条件>   | 列出符合条件的进程(port，TCP，@host)<br /> lsof -i [46] [protocol] [@hostname \| hostaddr] [:service \| prot]<br /> 46 :使用IPv4 或IPv6<br /> protocol：TCP 或 UDP<br /> hostname：连接其他主机地址<br /> hostaddr：ipv4连接位置 |
>   > | -u          | 列出UID号进程详情(用户标识码，启动进程的用户)                |
>   >
>   > **输出参数**
>   >
>   > ![image-20221206171607746](img\image-20221206171607746.png) 
>   >
>   > FD：文件描述符，cwd：当前目录，txt：txt文件，mem：内存映射文件
>   >
>   > TYPE：文件类型，REG：普通文件，CHR：字符，FIFO：管道或socket文件，netlink：网络
>   >
>   > SIZE：进程大小
>   >
>   > NODE：文件号
>   >
>   > **常用组合命令**
>   >
>   > 1. lsof -u mysql | grep deleted  ：查找mysql 用户打开并删除的文件
>   > 2. lsof -i
>
> - #### ip（显示或操作linux主机的路由，设备，策略路由和隧道）
>
>   > Ip [options] object{ command | help}
>   >
>   > options：
>   >
>   > object：link，address，addrlabel，route，rule，neigh，ntable，tunnel，tuntap，maddress，mroute，mrule，monitor，xfrm，netns，I2tp，tcp_metrics，token
>   >
>   > 
>
> -  iptraf
>
> - netstat
>
> - ldd
>
> - dstat
>
> - iftop
>

