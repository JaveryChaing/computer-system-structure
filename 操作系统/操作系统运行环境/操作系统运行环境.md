## 操作系统运行环境

- #### **处理器**

  > **处理器组成**
  >
  > 1. 运算器（处理器核心，负责算数运算与逻辑运算）
  > 2. 控制器（负责程序运行流程，取值，维护处理器状态，处理器与内存交互）
  > 3. 寄存器（存储处理器计算结果，地址及指令信息）
  >    - 用户寄存器（程序可用，减少内存访问次数，使程序运行速度最大化）
  >      - 数据寄存器（存储算数逻辑指令和访存方式）
  >      - 地址寄存器（存储物理地址，线性地址，有效地址）
  >      - 条件码寄存器（结果标记位，异常，中断标记位）
  >    - 控制、状态寄存器
  > 4. 高速缓存
  >
  > 
  >
  > **指令执行过程（单个指令周期）**
  >
  > 1. 处理器从存储器中读入指令
  > 2. 程序计数器指向下一条指令地址
  > 3. 将指令存入寄存器
  > 4. 处理器解析并执行这条指令
  >
  >  
  >
  > **处理器状态**
  >
  > *处理器依据运行程序资源和机器指令的使用权将处理器设置为不同状态*
  >
  > - 管态：操作系统的管理程序运行状态，具有较高的特权级别，可以执行所有指令，使用所有资源
  > - 目态：用户程序运行状态（不能直接使用系统资源，不能改变CPU工作状态）
  > - 目态到管态转换：中断
  > - 管态到目态转换：PSW指令（修改程序状态字）
  >
  > 
  >
  > **程序状态字（PSW）**
  >
  > *表示处理器当前的工作状态*
  >
  > - PSW 
  >   1. CPU的工作状态码（标识处于管态还是目态）
  >   2. 条件码（执行指令后结果特征）
  >   3. 中断屏蔽码（是否运行中断）
  > - PC(程序计数器)

- 系统硬件

  > *处理器唯一能直接访问的存储器为内存，任何程序和数据都必须装载入内存，处理器才能操作*
  >
  > - **存储系统**
  >
  >   - 类型
  >
  >     1. RAM 随机**存取**的程序数据
  >     2. ROM 只读存储器
  >
  >   - 存储保护
  >
  >     *防止应用程序恶意破坏数据，对系统内存中数据加以保护*
  >
  >     界地址存储器（通过内存上下限限制程序存取内存范围）
  >
  > - **I/O部件**
  >
  >   - I/O构造 
  >   - 通道（控制**外部设备与内存数据交互**，当外部设备结束工作后以事件中断方式通知CPU进行相应操作）
  >   - DMA技术（直接存储器访问）自动控制内存与I/O单元数据块，处理器控制DMA单元，由DMA单元与设备I/O进行数据交互
  >   - 缓存技术（解决输入速度与处理器速度不一致问题）
  >
  > - **时钟部件**
  >
  >   1. 处理系统死循环，访问机时浪费
  >   2. 在分时系统中，安装时间间隔轮询作业
  >   3. 实时系统中，按时间间隔输入输出作业
  >   4. 定时唤醒指定的事件
  >   5. 记录时间发生时间和时间间隔
  >
  >   硬件时钟主要通过**晶体振荡器**每间隔一定时间产生的脉冲频率，软件时钟利用**内存单元模拟时钟计数器**
  >
  >   - 绝对时间（不会被终止，同时使用公历时间显示）
  >   - 相对时间（计数器中计数间隔）

- #### 中断机制

  > **中断**：处理器对系统中或系统外发生的**异步事件的响应**(_异步事件是指无一定时序关系的随机发生事件_)
  >
  > - 中断作用
  >   1. 充分发挥处理器使用效率
  >   2. 提高系统实时能力
  >
  > **异常**：中断是由外部事件引发的，异常是正在执行的指令导致的
  >
  >  
  >
  > **中断与异常分类**
  >
  > - 典型的中断
  >   1. 时钟中断
  >   2. I/O中断
  >   3. 控制台中断（控制台指令）
  >   4. 硬件故障中断
  > - 异常
  >   1. 程序中断（除0异常，数据组越界）
  >   2. 访问指令异常（无超级指令执行权）
  >
  >  
  >
  > **中断系统**
  >
  > 1. 中断请求的接收
  >
  >    硬件使用中断寄存器，中断逻辑线路实现。中断逻辑线路用于接收中断信号，并把信号寄存到硬件触发器（中断寄存器）中
  >
  > 2. 中断响应
  >
  >    处理器在执行指令每个周期内会扫描中断寄存器是否有中断信号。存在中断信号，保存正在执行程序（PSW，PC下一条指令位置和寄存器上值）处理器切换到管态。处理器根据中断向量代码查询向量表，获取中断源相关联的中断处理程序入口地址，并将PC设置为该地址
  >
  > 3. 中断处理
  >
  >    1. 接收和响应中断，保护中断断点现场
  >    2. 分析中断向量，调用中断处理程序
  >    3. 中断处理结束，恢复现场，保持原有程序运行
  >
  >    **典型中断处理**
  >
  >    - I/O中断
  >
  >    - 时钟中断（通常优先级高于其他）
  >
  >      1. 维护系统软件时钟，控制定时任务及进程的处理时间配额
  >      2. 处理器调度，在时间片到达后选择下一个任务
  >      3. 控制定时任务，检测死锁，进行系统对账
  >      4. 实时处理（心跳检测）
  >
  >    - 硬件故障中断
  >
  >      *硬件故障带来的程序中断，需要人为干预*
  >
  >      - 程序式中断
  >
  >      - 系统服务请求中断
  >
  >        
  >
  > **中断分类**
  >
  > - 多级中断优先级作用
  >   1. 对各类中断信号依据紧急程度和重要级别划分等级
  >   2. 优先处理中断事件
  >      - 固定优先树
  >      - 轮转发（依次响应）
  > - 中断屏蔽
  >   - 延后处理（保存在寄存器中）
  >   - 直接丢弃
  > - 中断嵌套
  >   - 多个中断事件处理
  >     1. 在中断过程中，对新发生的中断延迟到下一周期处理
  >     2. 多层嵌套，在中断过程中，优先级高的事件可以打断只在执行优先级低的中断

- #### **系统调用**

> *用户程序调用系统提供的功能，指令由目态变为管态*
>
> **系统调用与程序调用区别**
>
> 1. 运行在不同的系统状态
> 2. 状态转换
> 3. 返回
> 4. 嵌套调用
>
> **常用的系统调用**
>
> - 进程控制类系统（对进程控制，包括创建，终止，设置进程属性）
> - 文件操作系统（读写文件）
> - 进程通讯类系统（进程之间数据共享）
> - 设备管理类系统（请求调用相关设备）
> - 信息维护类系统
>
> **系统调用与库函数，API，内核函数关系**
>
>  C函数库，API实现对内核功能进行包装，使开发人员不必了解内核运作流程
>
> - 应用程序-> C函数库、API接口 -> 系统调用（内核）
>
> - 应用程序->系统调用（内核）
>
> 
> 
> **系统调用过程**
>
> 

